# 各种语句的示例：

# 查询语句
192.168.1.174:9200/42/_search
{
    "query": {
        "function_score": {
            "query": {
                 "match_all": {}
            },
            "script_score": {
                "script": {
                    "lang": "painless",
                    "params": {
                        "vector": [0.672082, 0.945075, -0.600208, 0.746877, -0.500331, 0.744225, 0.970753, -0.617146, 0.155023, 0.06222, -0.646624, -0.920889, -0.463271, 0.943603, 0.832762, -0.994835, 0.143063, 0.257318, 0.001573, -0.943208, 0.449453, 0.025377, -0.236053, 0.029837, -0.092038, -0.229467, 0.457206, 0.989254, 0.1061, 0.653578, -0.814439, 0.467219, 0.97331, -0.189468, -0.943078, -0.147919, 0.282375, 0.055439, -0.493939, 0.698914, 0.760407, 0.284641, -0.487552, -0.113971, -0.308871, -0.311979, 0.563285, -0.946339, -0.262089, -0.607781, 0.426215, -0.940297, 0.654232, -0.474478, 0.217789, 0.979481, 0.509597, -0.756376, 0.489691, 0.983504, -0.589788, 0.908674, -0.324898, -0.031336, -0.310362, -0.283986, -0.342979, -0.289017, 0.207984, 0.65563, -0.626884, 0.185915, -0.165979, -0.784678, 0.367723, -0.409829, -0.551699, -0.039547, 0.701079, -0.402258, -0.425013, -0.003561, -0.93869, -0.256446, -0.411328, -0.101528, 0.688402, 0.118232, -0.625324, 0.231848, 0.277037, 0.237735, 0.860356, 0.058098, -0.752715, 0.634172, -0.669744, -0.868655, -0.08119, -0.765776, 0.765011, -0.742973, -0.290735, 0.69451, 0.064936, 0.790966, -0.886195, -0.537155, -0.044725, -0.91231, -0.337841, -0.767942, 0.818551, -0.354538, 0.485954, -0.308201, 0.799566, -0.240111, -0.302751, 0.198214, 0.599573, 0.176405, 0.023653, -0.543318, -0.704973, -0.391436, -0.795976, -0.076941]
                    },
                    "source": "double total = 0.0; for (int i = 0; i < 128; ++i) { total += (doc['faceFeature'][i] - i*2) * params.vector[i]; } return total;"
                }
            },
            "boost_mode": "replace"
        }
    },
    "size": 5
}

# 修改setting，设置刷新间隔为30s可以有效降低segment合并压力，
curl -XPUT '192.168.1.140:9200/my_index/_settings' -d '
{
    "index" : {
        "refresh_interval" : -1
    }
}
'

# 新的查询语句，先根据每一维进行过滤，然后对最后的结果进行cos距离计算。本次实验index数据量为5kw。
192.168.1.174:9200/2003/_search
{
    "query": {
        "function_score": {
            "query": {
                "bool": {
                	"must": {
                		"range" : {
				        	"item0" : { "gte" : -0.3, "lte" : 0.7 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item1" : { "gte" : -0.7, "lte" : 0.3 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item2" : { "gte" : -0.5, "lte" : 0.5 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item3" : { "gte" : -0.5, "lte" : 0.5 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item4" : { "gte" : -0.5, "lte" : 0.5 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item5" : { "gte" : -0.5, "lte" : 0.5 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item6" : { "gte" : -0.5, "lte" : 0.5 }
				        }
                	},
                	"must": {
                		"range" : {
				        	"item7" : { "gte" : -0.5, "lte" : 0.5 }
				        }
                	}
                }
            },
            "script_score": {
                "script": {
                    "lang": "painless",
                    "params": {
                        "vector": [0.672082, 0.945075, -0.600208, 0.746877, -0.500331, 0.744225, 0.970753, -0.617146, 0.155023, 0.06222, -0.646624, -0.920889, -0.463271, 0.943603, 0.832762, -0.994835, 0.143063, 0.257318, 0.001573, -0.943208, 0.449453, 0.025377, -0.236053, 0.029837, -0.092038, -0.229467, 0.457206, 0.989254, 0.1061, 0.653578, -0.814439, 0.467219, 0.97331, -0.189468, -0.943078, -0.147919, 0.282375, 0.055439, -0.493939, 0.698914, 0.760407, 0.284641, -0.487552, -0.113971, -0.308871, -0.311979, 0.563285, -0.946339, -0.262089, -0.607781, 0.426215, -0.940297, 0.654232, -0.474478, 0.217789, 0.979481, 0.509597, -0.756376, 0.489691, 0.983504, -0.589788, 0.908674, -0.324898, -0.031336, -0.310362, -0.283986, -0.342979, -0.289017, 0.207984, 0.65563, -0.626884, 0.185915, -0.165979, -0.784678, 0.367723, -0.409829, -0.551699, -0.039547, 0.701079, -0.402258, -0.425013, -0.003561, -0.93869, -0.256446, -0.411328, -0.101528, 0.688402, 0.118232, -0.625324, 0.231848, 0.277037, 0.237735, 0.860356, 0.058098, -0.752715, 0.634172, -0.669744, -0.868655, -0.08119, -0.765776, 0.765011, -0.742973, -0.290735, 0.69451, 0.064936, 0.790966, -0.886195, -0.537155, -0.044725, -0.91231, -0.337841, -0.767942, 0.818551, -0.354538, 0.485954, -0.308201, 0.799566, -0.240111, -0.302751, 0.198214, 0.599573, 0.176405, 0.023653, -0.543318, -0.704973, -0.391436, -0.795976, -0.076941]
                    },
                    "source": "return doc['item0'].value * params.vector[0] + doc['item1'].value * params.vector[1] + doc['item2'].value * params.vector[2] + doc['item3'].value * params.vector[3] + doc['item4'].value * params.vector[4] + doc['item5'].value * params.vector[5] + doc['item6'].value * params.vector[6] + doc['item7'].value * params.vector[7] + doc['item8'].value * params.vector[8] + doc['item9'].value * params.vector[9] + doc['item10'].value * params.vector[10] + doc['item11'].value * params.vector[11] + doc['item12'].value * params.vector[12] + doc['item13'].value * params.vector[13] + doc['item14'].value * params.vector[14] + doc['item15'].value * params.vector[15] + doc['item16'].value * params.vector[16] + doc['item17'].value * params.vector[17] + doc['item18'].value * params.vector[18] + doc['item19'].value * params.vector[19] + doc['item20'].value * params.vector[20] + doc['item21'].value * params.vector[21] + doc['item22'].value * params.vector[22] + doc['item23'].value * params.vector[23] + doc['item24'].value * params.vector[24] + doc['item25'].value * params.vector[25] + doc['item26'].value * params.vector[26] + doc['item27'].value * params.vector[27] + doc['item28'].value * params.vector[28] + doc['item29'].value * params.vector[29] + doc['item30'].value * params.vector[30] + doc['item31'].value * params.vector[31] + doc['item32'].value * params.vector[32] + doc['item33'].value * params.vector[33] + doc['item34'].value * params.vector[34] + doc['item35'].value * params.vector[35] + doc['item36'].value * params.vector[36] + doc['item37'].value * params.vector[37] + doc['item38'].value * params.vector[38] + doc['item39'].value * params.vector[39] + doc['item40'].value * params.vector[40] + doc['item41'].value * params.vector[41] + doc['item42'].value * params.vector[42] + doc['item43'].value * params.vector[43] + doc['item44'].value * params.vector[44] + doc['item45'].value * params.vector[45] + doc['item46'].value * params.vector[46] + doc['item47'].value * params.vector[47] + doc['item48'].value * params.vector[48] + doc['item49'].value * params.vector[49] + doc['item50'].value * params.vector[50] + doc['item51'].value * params.vector[51] + doc['item52'].value * params.vector[52] + doc['item53'].value * params.vector[53] + doc['item54'].value * params.vector[54] + doc['item55'].value * params.vector[55] + doc['item56'].value * params.vector[56] + doc['item57'].value * params.vector[57] + doc['item58'].value * params.vector[58] + doc['item59'].value * params.vector[59] + doc['item60'].value * params.vector[60] + doc['item61'].value * params.vector[61] + doc['item62'].value * params.vector[62] + doc['item63'].value * params.vector[63] + doc['item64'].value * params.vector[64] + doc['item65'].value * params.vector[65] + doc['item66'].value * params.vector[66] + doc['item67'].value * params.vector[67] + doc['item68'].value * params.vector[68] + doc['item69'].value * params.vector[69] + doc['item70'].value * params.vector[70] + doc['item71'].value * params.vector[71] + doc['item72'].value * params.vector[72] + doc['item73'].value * params.vector[73] + doc['item74'].value * params.vector[74] + doc['item75'].value * params.vector[75] + doc['item76'].value * params.vector[76] + doc['item77'].value * params.vector[77] + doc['item78'].value * params.vector[78] + doc['item79'].value * params.vector[79] + doc['item80'].value * params.vector[80] + doc['item81'].value * params.vector[81] + doc['item82'].value * params.vector[82] + doc['item83'].value * params.vector[83] + doc['item84'].value * params.vector[84] + doc['item85'].value * params.vector[85] + doc['item86'].value * params.vector[86] + doc['item87'].value * params.vector[87] + doc['item88'].value * params.vector[88] + doc['item89'].value * params.vector[89] + doc['item90'].value * params.vector[90] + doc['item91'].value * params.vector[91] + doc['item92'].value * params.vector[92] + doc['item93'].value * params.vector[93] + doc['item94'].value * params.vector[94] + doc['item95'].value * params.vector[95] + doc['item96'].value * params.vector[96] + doc['item97'].value * params.vector[97] + doc['item98'].value * params.vector[98] + doc['item99'].value * params.vector[99] + doc['item100'].value * params.vector[100] + doc['item101'].value * params.vector[101] + doc['item102'].value * params.vector[102] + doc['item103'].value * params.vector[103] + doc['item104'].value * params.vector[104] + doc['item105'].value * params.vector[105] + doc['item106'].value * params.vector[106] + doc['item107'].value * params.vector[107] + doc['item108'].value * params.vector[108] + doc['item109'].value * params.vector[109] + doc['item110'].value * params.vector[110] + doc['item111'].value * params.vector[111] + doc['item112'].value * params.vector[112] + doc['item113'].value * params.vector[113] + doc['item114'].value * params.vector[114] + doc['item115'].value * params.vector[115] + doc['item116'].value * params.vector[116] + doc['item117'].value * params.vector[117] + doc['item118'].value * params.vector[118] + doc['item119'].value * params.vector[119] + doc['item120'].value * params.vector[120] + doc['item121'].value * params.vector[121] + doc['item122'].value * params.vector[122] + doc['item123'].value * params.vector[123] + doc['item124'].value * params.vector[124] + doc['item125'].value * params.vector[125] + doc['item126'].value * params.vector[126] + doc['item127'].value * params.vector[127]"
                }
            },
            "boost_mode": "replace"
        }
    },
    "size": 2
}

查询结果：
```
{
    "took": 277618,
    "timed_out": false,
    "_shards": {
        "total": 32,
        "successful": 32,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 195603,
        "max_score": 15.323401,
        "hits": [
            {
                "_index": "2003",
                "_type": "testData",
                "_id": "2017-10-25_17:38:00_0.2782070734498491",
                "_score": 15.323401,
                "_source": {
                    "item0": 0.6713068078079949,
                    "item1": -0.5610479463500182,
                    "item2": 0.49670365831049845,
                    "item3": -0.40711853758272043,
                    "item4": -0.013703568882209582,
                    "item5": 0.34841084301282055,
                    "item6": 0.330220437396997,
                    "item7": -0.23963782209125917,
                    "item8": -0.4450994693480621,
                    "item9": -0.41231823226507336,
                    "item10": 0.3282193297078764,
                    "item11": -0.0677135870333827,
                    "item12": 0.47343125441382394,
                    "item13": 0.7394505717617144,
                    "item14": 0.269736863909007,
                    "item15": -0.9589829729553065,
                    "item16": 0.14929825648005646,
                    "item17": -0.010543073941341685,
                    "item18": 0.23273875944240685,
                    "item19": -0.1832516759532299,
                    "item20": 0.6886148152192553,
                    "item21": -0.3999995557621243,
                    "item22": 0.7369573725356198,
                    "item23": 0.996460352193667,
                    "item24": -0.1967885475354234,
                    "item25": -0.8052990512957572,
                    "item26": 0.2752947319900998,
                    "item27": 0.3535802856892625,
                    "item28": 0.6939523276748558,
                    "item29": 0.28541684969504266,
                    "item30": 0.8584866828299462,
                    "item31": 0.9613230786834919,
                    "item32": -0.2534686767448271,
                    "item33": -0.8615019922100997,
                    "item34": -0.3729953554628975,
                    "item35": -0.8480230565943485,
                    "item36": 0.22504666294697806,
                    "item37": -0.548264899979038,
                    "item38": -0.666676231720754,
                    "item39": 0.34316443308715017,
                    "item40": 0.31692892226134495,
                    "item41": 0.1602566843111568,
                    "item42": 0.5809684565206106,
                    "item43": -0.0281024101421663,
                    "item44": 0.377803492471525,
                    "item45": -0.1940671197716397,
                    "item46": 0.9026037398678555,
                    "item47": -0.5112418331719617,
                    "item48": -0.18385338486944502,
                    "item49": -0.5274758710238019,
                    "item50": -0.6726077028055875,
                    "item51": -0.8268909642941977,
                    "item52": -0.713989078212304,
                    "item53": 0.2004924485100672,
                    "item54": -0.6654541834624297,
                    "item55": 0.5474549711663608,
                    "item56": 0.9041242118108799,
                    "item57": 0.4526080388813223,
                    "item58": -0.22403248499174255,
                    "item59": -0.5618005142070839,
                    "item60": -0.7362291526528799,
                    "item61": 0.7079524612415156,
                    "item62": -0.4783143623388293,
                    "item63": 0.17372800652670595,
                    "item64": -0.03517079873007556,
                    "item65": -0.0010640065578426672,
                    "item66": -0.9889735887904927,
                    "item67": -0.6826997599720825,
                    "item68": 0.8863519800719426,
                    "item69": 0.5216231656096371,
                    "item70": -0.6041985496985092,
                    "item71": 0.6276833944240163,
                    "item72": 0.4961121815396705,
                    "item73": 0.15611626958834757,
                    "item74": 0.8479519722200726,
                    "item75": -0.0070727509495915886,
                    "item76": -0.574852689969052,
                    "item77": -0.5461201221218466,
                    "item78": -0.3359904055662848,
                    "item79": -0.9299658638827273,
                    "item80": 0.33916506309151284,
                    "item81": 0.020284485392629836,
                    "item82": -0.907710493540044,
                    "item83": -0.5960487488306534,
                    "item84": 0.9926368728221779,
                    "item85": 0.48753841107703755,
                    "item86": 0.8165096417026771,
                    "item87": -0.48318432855650406,
                    "item88": -0.09074945078619412,
                    "item89": 0.8240885358534038,
                    "item90": 0.036505366914832305,
                    "item91": 0.6507937356242157,
                    "item92": 0.695847805880472,
                    "item93": 0.9981516108670536,
                    "item94": -0.35528521432733307,
                    "item95": 0.7349861646807929,
                    "item96": 0.6166389228308666,
                    "item97": -0.9940817287721448,
                    "item98": 0.17864427189564291,
                    "item99": -0.739985460854214,
                    "item100": 0.421327325395223,
                    "item101": 0.012253816734823841,
                    "item102": -0.6026495372938596,
                    "item103": 0.9964527900066567,
                    "item104": -0.8188941654303972,
                    "item105": 0.6954791978250163,
                    "item106": -0.6772655503080862,
                    "item107": -0.0889293201896697,
                    "item108": 0.3191006373670484,
                    "item109": -0.5676825190003421,
                    "item110": -0.006870714145183365,
                    "item111": -0.3192799485154323,
                    "item112": -0.16535182435999252,
                    "item113": 0.2199745479818589,
                    "item114": -0.5428959913781954,
                    "item115": 0.38673856783081795,
                    "item116": -0.8759794670155279,
                    "item117": -0.7880535760606775,
                    "item118": 0.5225884198925774,
                    "item119": 0.5255490751901948,
                    "item120": 0.5868607436224018,
                    "item121": -0.967376966084633,
                    "item122": 0.7151778417034476,
                    "item123": -0.40611034414391645,
                    "item124": -0.9112498079048268,
                    "item125": -0.34191846894190614,
                    "item126": -0.6835417660020464,
                    "item127": 0.1714486608550454
                }
            },
            {
                "_index": "2003",
                "_type": "testData",
                "_id": "2017-10-25_14:43:59_0.7339236788615077",
                "_score": 15.034479,
                "_source": {
                    "item0": 0.6261894421939986,
                    "item1": -0.33069113326929966,
                    "item2": -0.06382158939226157,
                    "item3": -0.21902304818613838,
                    "item4": -0.4633094730455867,
                    "item5": 0.149251112187748,
                    "item6": -0.010815614269676255,
                    "item7": -0.3711236112892584,
                    "item8": -0.45083032443954396,
                    "item9": 0.1478566032023403,
                    "item10": -0.032096665913786016,
                    "item11": -0.36902031362646426,
                    "item12": 0.9343956113803629,
                    "item13": 0.7849800261517879,
                    "item14": 0.7156840237610702,
                    "item15": 0.7062840119740432,
                    "item16": 0.9204993812491771,
                    "item17": 0.7659778003222515,
                    "item18": 0.9966054271623677,
                    "item19": -0.8278924983564215,
                    "item20": -0.24311492340036822,
                    "item21": 0.5789431246170094,
                    "item22": 0.001561595919266745,
                    "item23": -0.6650782437694958,
                    "item24": 0.1579262661956684,
                    "item25": -0.1796013384502404,
                    "item26": -0.8050224261080385,
                    "item27": 0.8640917996202275,
                    "item28": -0.8048875255145789,
                    "item29": -0.3595243745352561,
                    "item30": -0.40867033194449776,
                    "item31": 0.5928717104992742,
                    "item32": 0.8254506792879339,
                    "item33": 0.8083717083832009,
                    "item34": -0.9239675237104521,
                    "item35": 0.5570196903653422,
                    "item36": -0.3244318862911162,
                    "item37": 0.2211476621044297,
                    "item38": -0.7768540605573682,
                    "item39": -0.9400880197056145,
                    "item40": 0.44510249407795954,
                    "item41": 0.8136869920855963,
                    "item42": 0.21274762719157692,
                    "item43": -0.6559495413517475,
                    "item44": 0.3496069299302724,
                    "item45": -0.22509116752235125,
                    "item46": -0.08629577854841841,
                    "item47": -0.9476253133997321,
                    "item48": 0.39233661081418436,
                    "item49": -0.264909546110935,
                    "item50": 0.9729682839211287,
                    "item51": -0.9211951269866718,
                    "item52": 0.9359266630908913,
                    "item53": -0.8385791695849019,
                    "item54": -0.1595841641031852,
                    "item55": 0.635957287593077,
                    "item56": 0.03910877138602431,
                    "item57": -0.41632804105989196,
                    "item58": 0.05863228397518783,
                    "item59": 0.40898984949687134,
                    "item60": -0.669742586726563,
                    "item61": 0.4691416718105512,
                    "item62": 0.8599431322304596,
                    "item63": -0.48194894964107404,
                    "item64": -0.1913053004757197,
                    "item65": -0.4242144036968942,
                    "item66": -0.8616215943612398,
                    "item67": 0.677820900260556,
                    "item68": 0.8963257402114664,
                    "item69": -0.5652771698454144,
                    "item70": 0.20214835013312604,
                    "item71": -0.5788516682588565,
                    "item72": 0.3063149005984276,
                    "item73": -0.7519352446170013,
                    "item74": 0.36260102696197727,
                    "item75": -0.45519492691988117,
                    "item76": -0.14784417667179284,
                    "item77": -0.06471742962528482,
                    "item78": 0.3785198694071157,
                    "item79": 0.038891556794496074,
                    "item80": -0.810372477592993,
                    "item81": 0.3210942879624328,
                    "item82": -0.9499863050246788,
                    "item83": 0.6774465288344635,
                    "item84": -0.33423021059699454,
                    "item85": 0.5301178535071467,
                    "item86": 0.8441385223770868,
                    "item87": 0.17632634374003908,
                    "item88": -0.056847926761884215,
                    "item89": 0.5383026387433711,
                    "item90": 0.33478395624776924,
                    "item91": 0.36543771625361754,
                    "item92": -0.125649813318375,
                    "item93": -0.4715828972310001,
                    "item94": -0.5477535869647658,
                    "item95": 0.17592096354395736,
                    "item96": -0.779313914328168,
                    "item97": -0.793364059335935,
                    "item98": -0.9366983416683696,
                    "item99": 0.4088982165649,
                    "item100": -0.7590733619771164,
                    "item101": -0.44046366233333867,
                    "item102": 0.2404809330372064,
                    "item103": 0.23091546218257375,
                    "item104": -0.08022243289494879,
                    "item105": 0.6655769727825462,
                    "item106": 0.7296441907859672,
                    "item107": -0.867775976419352,
                    "item108": -0.3373502735963507,
                    "item109": -0.8775984819479259,
                    "item110": 0.587836135663754,
                    "item111": -0.31243833485859596,
                    "item112": -0.3476843914073635,
                    "item113": 0.4110713197242484,
                    "item114": -0.26120024226471283,
                    "item115": 0.8751096745935611,
                    "item116": -0.25528607814273596,
                    "item117": -0.9094005889524586,
                    "item118": -0.7185858570468253,
                    "item119": 0.9378179435534058,
                    "item120": 0.7753016204563281,
                    "item121": -0.8990767122417982,
                    "item122": -0.2132873576062877,
                    "item123": 0.8123056250939864,
                    "item124": -0.546007322326779,
                    "item125": 0.6497188541753653,
                    "item126": -0.4679706121305225,
                    "item127": 0.004060065832423465
                }
            }
        }
    }
}
```